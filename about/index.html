<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FreeChessed AI Tutor</title>
    <link rel="stylesheet" href="globals.css" />
    <link rel="stylesheet" href="styleguide.css" />
    <link rel="stylesheet" href="style.css" />
    <script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
</head>
<body>
    <div class="desktop">
        <!-- Sidebar Navigation -->
        <div class="sidebar">
            <div class="top">
                <a class="logo" id="logo-home-link" href="#">
                    <img src="logo.png" alt="Logo">
                    <div class="ABC-solutions">FreeChessed AI Tutor</div>
                </a>
            </div>
            <div class="main">
                <div class="nav" id="sidebar-nav">
                    <!-- Navigation items will be injected by JS -->
                </div>
                <img class="line" src="https://c.animaapp.com/mgbehc8rLFcChm/img/line-1-1.svg" />
                <div class="nav">
                    <div class="inner-wrapper">
                        <div class="inner">
                            <div class="icon"><img class="img" src="https://c.animaapp.com/mgbehc8rLFcChm/img/icon-16.svg" /></div>
                            <div class="text-wrapper">Profile</div>
                        </div>
                    </div>
                    <div class="inner-wrapper">
                        <div class="inner">
                            <div class="icon"><img class="img" src="https://c.animaapp.com/mgbehc8rLFcChm/img/icon-1.svg" /></div>
                            <div class="text-wrapper">Settings</div>
                        </div>
                    </div>
                    <div class="inner-wrapper">
                        <div class="inner">
                            <div class="icon"><img class="img" src="https://c.animaapp.com/mgbehc8rLFcChm/img/icon-13.svg" /></div>
                            <div class="text-wrapper">Contribute</div>
                        </div>
                    </div>
                </div>
            </div>
            <footer class="footer">
                <div class="div">
                    <div class="avatar">
                        <img class="big-shoes-avatar" src="https://c.animaapp.com/mgbehc8rLFcChm/img/big-shoes-avatar-4.png" />
                    </div>
                    <div class="text-group">
                        <div class="welcome-back">johndoe@gmail.com</div>
                        <div class="johnathan">John Doe</div>
                    </div>
                </div>
                <img class="img" src="https://c.animaapp.com/mgbehc8rLFcChm/img/caret.svg" />
            </footer>
        </div>
        <div class="main-content">
            <div class="content-card">
                <h1>Welcome to the Test Page</h1>
                <p>This is a test HTML page demonstrating a simple navigation bar with both internal and external links. External links will open in a new tab.</p>
                <h2>Page Content</h2>
                <p>Here is some sample content below the navigation bar.</p>
            </div>
        </div>
    </div>
    <script>
      // Raw GitHub URL for navigation.yml 
      const NAV_YML_URL = 'https://raw.githubusercontent.com/FreeChessed/about/main/_data/navigation.yml';

      // Optional: Add icons for each nav item
      const navIcons = {
        Home: "https://c.animaapp.com/mgbehc8rLFcChm/img/icon-5.svg",
        About: "https://c.animaapp.com/mgbehc8rLFcChm/img/icon-18.svg",
        "AI Tutor": "https://c.animaapp.com/mgbehc8rLFcChm/img/icon-9.svg",
        Analyze: "https://c.animaapp.com/mgbehc8rLFcChm/img/icon-10.svg",
        Puzzles: "https://c.animaapp.com/mgbehc8rLFcChm/img/icon-12.svg"
      };

      function getActiveNavTitle() {
        // Example logic: match page for "Home" or "About"
        const path = window.location.pathname.toLowerCase();
        if (path.endsWith("/home/index.html")) return "Home";
        if (path.endsWith("/about/index.html")) return "About";
        // fallback, can use document.title or other logic
        return "";
      }

      async function loadNavigation() {
        try {
          const response = await fetch(NAV_YML_URL);
          if (!response.ok) throw new Error('Failed to load navigation.yml');
          const yamlText = await response.text();
          const navigation = jsyaml.load(yamlText);

          // Find "home" link from navigation
          const homeItem = navigation.find(item => item.title.toLowerCase() === "home");
          if (homeItem) document.getElementById('logo-home-link').setAttribute('href', homeItem.url);

          const sidebarNav = document.getElementById('sidebar-nav');
          sidebarNav.innerHTML = "";

          const activeTitle = getActiveNavTitle();

          navigation.forEach(item => {
            const wrapper = document.createElement('div');
            wrapper.className = "inner-wrapper";

            // Apply active style using class if matches
            if(item.title === activeTitle) {
                wrapper.style.backgroundColor = "#bab6ff40";
            }

            wrapper.onclick = function() {
                if (/^https?:\/\//.test(item.url)) {
                    window.open(item.url, "_blank", "noopener");
                } else {
                    window.location.href = item.url;
                }
            };

            const inner = document.createElement('div');
            inner.className = "inner";

            const iconDiv = document.createElement('div');
            iconDiv.className = "icon";
            const iconImg = document.createElement('img');
            iconImg.className = "img";
            iconImg.src = navIcons[item.title] || navIcons['Home'];
            iconDiv.appendChild(iconImg);

            const labelDiv = document.createElement('div');
            labelDiv.className = "label";
            labelDiv.textContent = item.title;

            inner.appendChild(iconDiv);
            inner.appendChild(labelDiv);
            wrapper.appendChild(inner);
            sidebarNav.appendChild(wrapper);

            // Active state: icon and label white (no animation)
            if(item.title === activeTitle) {
                labelDiv.style.color = "#ffffff";
                iconImg.style.filter = "brightness(0) invert(1)";
            }
          });
        } catch (err) {
          console.error('Navigation bar failed to load:', err);
          document.getElementById('sidebar-nav').innerHTML = '<div class="nav-item"><div class="inner">Navbar failed to load</div></div>';
        }
      }

      loadNavigation();
    </script>
</body>
</html>
